{"cells":[{"cell_type":"markdown","metadata":{"id":"XceU1d9mCtwH"},"source":["# From SQL to pandas challenge 7"]},{"cell_type":"code","execution_count":1,"metadata":{"id":"GGPFlTHoCtwK","executionInfo":{"status":"ok","timestamp":1674542034416,"user_tz":-60,"elapsed":4874,"user":{"displayName":"Gözde Barın","userId":"12022579294192179294"}}},"outputs":[],"source":["# import libraries\n","import pandas as pd\n","\n","# load data\n","# This code is made to load our data stored on Google Drive\n","def gd_path(file_id):\n","    \"\"\"Generate a shareable link from Google Drive file id.\"\"\"\n","    return f\"https://drive.google.com/uc?export=download&id={file_id}\"\n","\n","# Google Drive file ids\n","files_id = {\n","    \"titleauthor\": \"1F1JOiYXStWacOBca6coNVfyVtoST7ZgD\",\n","    \"titles\": \"1PLdn50N9GRa53ZbuVWo0l47F_IXdvlEm\",\n","    \"stores\": \"1f-GCgip7O93CpbAkYvOsc21eKnSOSHsQ\", \n","    \"sales\": \"1fzFc9rwYmVIPaGOFmhLVxCi3kg19vNU2\", \n","    \"roysched\": \"1zPRZPoFPEMKyrNR5VSENeYFHGCBZmxbs\", \n","    \"publishers\": \"1s9E8_AVOziTrowb3wyh2jg3PV763VOyq\",\n","    \"pub_info\": \"1OEgogcGKy--EpuVj0kqq7lyBZNGW6YSv\", \n","    \"jobs\": \"1V1Za8hUdXD-vJOyRdX4aQV5wanIff2eM\", \n","    \"employee\": \"1h9mUjsVqpP74b1w0x7KOw37n_n9Ulkt5\", \n","    \"discounts\": \"111dvSxMcCsTgOuV1wDSKFJxO1Xcxd9VS\", \n","    \"authors\": \"1fEF89Nhe61EebAljKlwFwfEuokK0o6aJ\"\n","}\n","\n","# Read data from Google Drive\n","authors = pd.read_csv(gd_path(files_id[\"authors\"]), sep=\";\")\n","titles = pd.read_csv(gd_path(files_id[\"titles\"]), sep=\";\")\n","sales = pd.read_csv(gd_path(files_id[\"sales\"]), sep=\";\")\n","employee = pd.read_csv(gd_path(files_id[\"employee\"]), sep=\";\")\n","publishers = pd.read_csv(gd_path(files_id[\"publishers\"]), sep=\";\")"]},{"cell_type":"markdown","metadata":{"id":"Vl2GObcaCtwL"},"source":["## 1. Find the total amount of authors for each state"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"Gj-HfTLlCtwL","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1673475652901,"user_tz":-60,"elapsed":339,"user":{"displayName":"Gözde Barın","userId":"12022579294192179294"}},"outputId":"c59defc0-7293-441c-ec51-8af41ec1315b"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["state\n","CA    15\n","IN     1\n","KS     1\n","MD     1\n","MI     1\n","OR     1\n","TN     1\n","UT     2\n","Name: au_id, dtype: int64"]},"metadata":{},"execution_count":4}],"source":["\n","authors.groupby('state').au_id.nunique()\n"]},{"cell_type":"markdown","metadata":{"id":"w3b-4uZaCtwL"},"source":["### Hint:"]},{"cell_type":"markdown","metadata":{"id":"2xYHhin7CtwM"},"source":["In SQL the syntax is:\n","\n","```sql\n","SELECT COUNT(au_id) , state\n","FROM authors\n","group by state;\n","```"]},{"cell_type":"markdown","metadata":{"id":"g0M6PXWRCtwM"},"source":["## 2. Find the total amount of authors by each state and order them in descending order"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"z6ieTOc_CtwN","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1673392166063,"user_tz":-60,"elapsed":219,"user":{"displayName":"Gözde Barın","userId":"12022579294192179294"}},"outputId":"e465d746-e4b9-4dec-bac7-3594efe581a4"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["state\n","CA    15\n","UT     2\n","IN     1\n","KS     1\n","MD     1\n","MI     1\n","OR     1\n","TN     1\n","Name: au_id, dtype: int64"]},"metadata":{},"execution_count":25}],"source":["authors.groupby(\"state\").au_id.nunique().sort_values(ascending=False)\n","\n"]},{"cell_type":"markdown","metadata":{"id":"DHFkk50PCtwN"},"source":["### Hint:"]},{"cell_type":"markdown","metadata":{"id":"8bPalflzCtwN"},"source":["In SQL the syntax is:\n","\n","```sql\n","SELECT COUNT(au_id) Total,state\n","FROM authors\n","GROUP BY state\n","ORDER BY (total) DESC;\n","```"]},{"cell_type":"markdown","metadata":{"id":"wV_ye4IECtwO"},"source":["## 3. What's the price of the most expensive title from each publisher?"]},{"cell_type":"code","execution_count":2,"metadata":{"id":"w441yvkXCtwO","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1674542143035,"user_tz":-60,"elapsed":270,"user":{"displayName":"Gözde Barın","userId":"12022579294192179294"}},"outputId":"e273c006-e7ce-4db1-860c-2d90ab40586a"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["pub_id\n","1389    22.95\n","877     21.59\n","736     19.99\n","Name: price, dtype: float64"]},"metadata":{},"execution_count":2}],"source":["titles.groupby([\"pub_id\"]).price.max().sort_values(ascending = False)\n","\n"]},{"cell_type":"markdown","metadata":{"id":"K7CgHw2ECtwO"},"source":["### Hint:"]},{"cell_type":"markdown","metadata":{"id":"fbSlgKjKCtwO"},"source":["In SQL the syntax is:\n","\n","```sql\n","SELECT MAX(price), pub_id\n","FROM titles\n","GROUP BY pub_id;\n","```"]},{"cell_type":"markdown","metadata":{"id":"jpRDx0S6CtwO"},"source":["## 4. Find out the top 3 stores with the most sales"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"PxhK2NNZCtwP","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1673393177370,"user_tz":-60,"elapsed":3,"user":{"displayName":"Gözde Barın","userId":"12022579294192179294"}},"outputId":"1ad6efac-f000-4187-bf15-b3beecd9f585"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["stor_id\n","7131    130\n","7066    125\n","7067     90\n","Name: qty, dtype: int64"]},"metadata":{},"execution_count":64}],"source":["sales.groupby('stor_id').qty.sum().sort_values(ascending = False).head(3)\n","\n"]},{"cell_type":"markdown","metadata":{"id":"iCjxJfDWCtwP"},"source":["### Hint:"]},{"cell_type":"markdown","metadata":{"id":"f89f2saHCtwP"},"source":["In SQL the syntax is:\n","\n","```sql\n","SELECT stor_id, SUM(qty)\n","FROM sales\n","GROUP BY stor_id\n","ORDER BY SUM(qty) DESC\n","LIMIT 3;\n","```"]},{"cell_type":"markdown","metadata":{"id":"uGFYC182CtwP"},"source":["## 5. Find the average job level for each job_id from the employees table.\n","    Order the jobs in ascending order by its average job level."]},{"cell_type":"code","execution_count":null,"metadata":{"id":"GTopgRnACtwP","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1673475995121,"user_tz":-60,"elapsed":249,"user":{"displayName":"Gözde Barın","userId":"12022579294192179294"}},"outputId":"ebf22bd7-bd97-42bf-8a19-1867c5dfede7"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["job_id\n","12     55.666667\n","13     66.333333\n","14     74.666667\n","10    101.750000\n","11    121.750000\n","9     123.250000\n","8     125.250000\n","7     142.500000\n","6     176.000000\n","5     187.285714\n","3     200.000000\n","2     215.000000\n","4     227.000000\n","Name: job_lvl, dtype: float64"]},"metadata":{},"execution_count":10}],"source":["employee.groupby(\"job_id\").job_lvl.mean().sort_values(by=\"job_lvl\")"]},{"cell_type":"markdown","metadata":{"id":"tHIocHh3CtwP"},"source":["### Hint:"]},{"cell_type":"markdown","metadata":{"id":"IPimaPrICtwP"},"source":["In SQL the syntax is:\n","\n","```sql\n","SELECT AVG(job_lvl), job_id\n","FROM employee\n","GROUP BY job_id\n","ORDER BY AVG(job_lvl);\n","```"]},{"cell_type":"markdown","metadata":{"id":"HAMx42XfCtwQ"},"source":["## 6. For each type (business, psychology…), find out how many books each publisher has"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"5OOUQA1LCtwQ","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1673512231474,"user_tz":-60,"elapsed":396,"user":{"displayName":"Gözde Barın","userId":"12022579294192179294"}},"outputId":"f57f4d1c-218a-4728-9b0d-4fcb0a876db5"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["pub_id  type        \n","736     business        1\n","        psychology      4\n","877     UNDECIDED       1\n","        mod_cook        2\n","        psychology      1\n","        trad_cook       3\n","1389    business        3\n","        popular_comp    3\n","Name: title_id, dtype: int64"]},"metadata":{},"execution_count":2}],"source":["titles.groupby([\"pub_id\", \"type\"]).title_id.count()\n"]},{"cell_type":"markdown","metadata":{"id":"Nf3DUeGlCtwQ"},"source":["### Hint:"]},{"cell_type":"markdown","metadata":{"id":"pPYCjyxWCtwQ"},"source":["In SQL the syntax is:\n","\n","```sql\n","SELECT pub_id, type, COUNT(title_id)\n","FROM titles\n","GROUP BY pub_id , type;\n","```"]},{"cell_type":"code","source":["titles.groupby([\"pub_id\", \"type\"]) .agg({\"title_id\" : \"count\"})"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":332},"id":"-9xDYOVH9-K2","executionInfo":{"status":"ok","timestamp":1673477584081,"user_tz":-60,"elapsed":219,"user":{"displayName":"Gözde Barın","userId":"12022579294192179294"}},"outputId":"c0531b64-fde3-4e2e-efc9-a6368293708b"},"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["                     title_id\n","pub_id type                  \n","736    business             1\n","       psychology           4\n","877    UNDECIDED            1\n","       mod_cook             2\n","       psychology           1\n","       trad_cook            3\n","1389   business             3\n","       popular_comp         3"],"text/html":["\n","  <div id=\"df-55a3aebd-13fe-44f5-82a3-ae028c3262b8\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th></th>\n","      <th>title_id</th>\n","    </tr>\n","    <tr>\n","      <th>pub_id</th>\n","      <th>type</th>\n","      <th></th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th rowspan=\"2\" valign=\"top\">736</th>\n","      <th>business</th>\n","      <td>1</td>\n","    </tr>\n","    <tr>\n","      <th>psychology</th>\n","      <td>4</td>\n","    </tr>\n","    <tr>\n","      <th rowspan=\"4\" valign=\"top\">877</th>\n","      <th>UNDECIDED</th>\n","      <td>1</td>\n","    </tr>\n","    <tr>\n","      <th>mod_cook</th>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>psychology</th>\n","      <td>1</td>\n","    </tr>\n","    <tr>\n","      <th>trad_cook</th>\n","      <td>3</td>\n","    </tr>\n","    <tr>\n","      <th rowspan=\"2\" valign=\"top\">1389</th>\n","      <th>business</th>\n","      <td>3</td>\n","    </tr>\n","    <tr>\n","      <th>popular_comp</th>\n","      <td>3</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-55a3aebd-13fe-44f5-82a3-ae028c3262b8')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-55a3aebd-13fe-44f5-82a3-ae028c3262b8 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-55a3aebd-13fe-44f5-82a3-ae028c3262b8');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":27}]},{"cell_type":"markdown","metadata":{"id":"0xpTiEmACtwQ"},"source":["## 7. Add the average price of each publisher - book type combination from your previous query"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"VMLNxdJiCtwQ","colab":{"base_uri":"https://localhost:8080/","height":363},"executionInfo":{"status":"ok","timestamp":1673512320149,"user_tz":-60,"elapsed":254,"user":{"displayName":"Gözde Barın","userId":"12022579294192179294"}},"outputId":"0fadad1b-ec9a-4a1d-ca4b-eb6ae2fa90ea"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["                    price           \n","                    count       mean\n","pub_id type                         \n","736    business         1   2.990000\n","       psychology       4  11.482500\n","877    UNDECIDED        1   0.000000\n","       mod_cook         2  11.490000\n","       psychology       1  21.590000\n","       trad_cook        3  15.963333\n","1389   business         3  17.310000\n","       popular_comp     3  14.316667"],"text/html":["\n","  <div id=\"df-51e768ba-7b6e-4553-8edb-6720c4a52ab9\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead tr th {\n","        text-align: left;\n","    }\n","\n","    .dataframe thead tr:last-of-type th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr>\n","      <th></th>\n","      <th></th>\n","      <th colspan=\"2\" halign=\"left\">price</th>\n","    </tr>\n","    <tr>\n","      <th></th>\n","      <th></th>\n","      <th>count</th>\n","      <th>mean</th>\n","    </tr>\n","    <tr>\n","      <th>pub_id</th>\n","      <th>type</th>\n","      <th></th>\n","      <th></th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th rowspan=\"2\" valign=\"top\">736</th>\n","      <th>business</th>\n","      <td>1</td>\n","      <td>2.990000</td>\n","    </tr>\n","    <tr>\n","      <th>psychology</th>\n","      <td>4</td>\n","      <td>11.482500</td>\n","    </tr>\n","    <tr>\n","      <th rowspan=\"4\" valign=\"top\">877</th>\n","      <th>UNDECIDED</th>\n","      <td>1</td>\n","      <td>0.000000</td>\n","    </tr>\n","    <tr>\n","      <th>mod_cook</th>\n","      <td>2</td>\n","      <td>11.490000</td>\n","    </tr>\n","    <tr>\n","      <th>psychology</th>\n","      <td>1</td>\n","      <td>21.590000</td>\n","    </tr>\n","    <tr>\n","      <th>trad_cook</th>\n","      <td>3</td>\n","      <td>15.963333</td>\n","    </tr>\n","    <tr>\n","      <th rowspan=\"2\" valign=\"top\">1389</th>\n","      <th>business</th>\n","      <td>3</td>\n","      <td>17.310000</td>\n","    </tr>\n","    <tr>\n","      <th>popular_comp</th>\n","      <td>3</td>\n","      <td>14.316667</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-51e768ba-7b6e-4553-8edb-6720c4a52ab9')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-51e768ba-7b6e-4553-8edb-6720c4a52ab9 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-51e768ba-7b6e-4553-8edb-6720c4a52ab9');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":4}],"source":["titles.groupby([\"pub_id\", \"type\"]) .agg({\"price\" : [ \"count\", \"mean\" ] })"]},{"cell_type":"markdown","metadata":{"id":"ea5KidA4CtwQ"},"source":["### Hint:"]},{"cell_type":"markdown","metadata":{"id":"6wugQL1OCtwR"},"source":["In SQL the syntax is:\n","\n","```sql\n","SELECT  AVG(price), COUNT(*), pub_id,type\n","FROM titles\n","GROUP BY pub_id, type;\n","```"]},{"cell_type":"markdown","source":["# BONUS\n","\n","This is part of the section Advanced Pandas."],"metadata":{"id":"4d20YWKMDKGw"}},{"cell_type":"markdown","metadata":{"id":"0-XRxi4pCtwR"},"source":["## 8. From your previous query, keep only the combinations of publisher - book type with an average price higher than 12"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"2LlvaKVYCtwR","colab":{"base_uri":"https://localhost:8080/","height":206},"executionInfo":{"status":"ok","timestamp":1673512451275,"user_tz":-60,"elapsed":4,"user":{"displayName":"Gözde Barın","userId":"12022579294192179294"}},"outputId":"a388ca22-a826-402a-a355-ec91d07aff2a"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["                     title_id      price\n","pub_id type                             \n","877    psychology           1  21.590000\n","       trad_cook            3  15.963333\n","1389   business             3  17.310000\n","       popular_comp         3  14.316667"],"text/html":["\n","  <div id=\"df-360f957b-74d4-4839-aff3-6bbdca7349b8\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th></th>\n","      <th>title_id</th>\n","      <th>price</th>\n","    </tr>\n","    <tr>\n","      <th>pub_id</th>\n","      <th>type</th>\n","      <th></th>\n","      <th></th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th rowspan=\"2\" valign=\"top\">877</th>\n","      <th>psychology</th>\n","      <td>1</td>\n","      <td>21.590000</td>\n","    </tr>\n","    <tr>\n","      <th>trad_cook</th>\n","      <td>3</td>\n","      <td>15.963333</td>\n","    </tr>\n","    <tr>\n","      <th rowspan=\"2\" valign=\"top\">1389</th>\n","      <th>business</th>\n","      <td>3</td>\n","      <td>17.310000</td>\n","    </tr>\n","    <tr>\n","      <th>popular_comp</th>\n","      <td>3</td>\n","      <td>14.316667</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-360f957b-74d4-4839-aff3-6bbdca7349b8')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-360f957b-74d4-4839-aff3-6bbdca7349b8 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-360f957b-74d4-4839-aff3-6bbdca7349b8');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":8}],"source":["books = titles.groupby([\"pub_id\", \"type\"]) .agg({\"title_id\": \"count\" ,\"price\" : \"mean\" })\n","\n","books[books[\"price\"] > 12]\n","\n"]},{"cell_type":"markdown","metadata":{"id":"MOi73UzPCtwR"},"source":["### Hint:"]},{"cell_type":"markdown","metadata":{"id":"a6Z38DDaCtwR"},"source":["In SQL the syntax is:\n","\n","```sql\n","SELECT pub_id,type, COUNT(*)\n","FROM titles\n","GROUP BY pub_id, type\n","HAVING AVG(price) > 12;\n","```"]},{"cell_type":"markdown","metadata":{"id":"SpDJAl20CtwR"},"source":["## 9. Order the results of your previous query by these two criteria:\n","1. Count of books, descendingly\n","2. Average price, descendingly"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"hha51jFlCtwR","colab":{"base_uri":"https://localhost:8080/","height":206},"executionInfo":{"status":"ok","timestamp":1673525701832,"user_tz":-60,"elapsed":543,"user":{"displayName":"Gözde Barın","userId":"12022579294192179294"}},"outputId":"c1018466-f869-485f-f49e-03e296fc2bc6"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["                     title_id      price\n","pub_id type                             \n","1389   business             3  17.310000\n","877    trad_cook            3  15.963333\n","1389   popular_comp         3  14.316667\n","877    psychology           1  21.590000"],"text/html":["\n","  <div id=\"df-e6e28f8f-6533-4d3b-ac16-a944e2f65e26\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th></th>\n","      <th>title_id</th>\n","      <th>price</th>\n","    </tr>\n","    <tr>\n","      <th>pub_id</th>\n","      <th>type</th>\n","      <th></th>\n","      <th></th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>1389</th>\n","      <th>business</th>\n","      <td>3</td>\n","      <td>17.310000</td>\n","    </tr>\n","    <tr>\n","      <th>877</th>\n","      <th>trad_cook</th>\n","      <td>3</td>\n","      <td>15.963333</td>\n","    </tr>\n","    <tr>\n","      <th>1389</th>\n","      <th>popular_comp</th>\n","      <td>3</td>\n","      <td>14.316667</td>\n","    </tr>\n","    <tr>\n","      <th>877</th>\n","      <th>psychology</th>\n","      <td>1</td>\n","      <td>21.590000</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-e6e28f8f-6533-4d3b-ac16-a944e2f65e26')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-e6e28f8f-6533-4d3b-ac16-a944e2f65e26 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-e6e28f8f-6533-4d3b-ac16-a944e2f65e26');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":3}],"source":["books = titles.groupby([\"pub_id\", \"type\"]) .agg({\"title_id\": \"count\" ,\"price\" : \"mean\" })\n","\n","books[books[\"price\"] > 12].sort_values(by=[\"title_id\", \"price\"], ascending= False)"]},{"cell_type":"markdown","metadata":{"id":"Fscbv5arCtwS"},"source":["### Hint:"]},{"cell_type":"markdown","metadata":{"id":"lNLFa3RRCtwS"},"source":["In SQL the syntax is:\n","\n","```sql\n","SELECT  pub_id, type, COUNT(*), AVG(price)\n","FROM titles\n","GROUP BY pub_id, type\n","HAVING AVG(price) > 12\n","ORDER BY COUNT(*) DESC, AVG(price) DESC;\n","```"]},{"cell_type":"markdown","metadata":{"id":"QnwScdzvCtwS"},"source":["## 10. Some authors have a contract, while others don't - it's indicated in the \"contract\" column of the authors table.\n","     \n","    Select all the states and cities where there are 2 or more contracts overall"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"BVb7UnbaCtwS"},"outputs":[],"source":[]},{"cell_type":"markdown","metadata":{"id":"qOP_sYlxCtwS"},"source":["### Hint:"]},{"cell_type":"markdown","metadata":{"id":"RccHe_zkCtwS"},"source":["In SQL the syntax is:\n","\n","```sql\n","SELECT SUM(contract),city,state\n","FROM authors\n","GROUP BY state,city\n","HAVING SUM(contract)>1;\n","```"]}],"metadata":{"kernelspec":{"display_name":"base","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.9.15 (main, Nov  4 2022, 16:35:55) [MSC v.1916 64 bit (AMD64)]"},"orig_nbformat":4,"vscode":{"interpreter":{"hash":"ad2bdc8ecc057115af97d19610ffacc2b4e99fae6737bb82f5d7fb13d2f2c186"}},"colab":{"provenance":[{"file_id":"1XL_2bMXG62TsCgA3qXMGYo3lk434Fgft","timestamp":1673391070936}]}},"nbformat":4,"nbformat_minor":0}